{% extends "base.html" %}
{% block title %}Editor - {{ document.title }}{% endblock %}

{% block content %}
<div class="container-fluid p-0">
    <div class="row g-0" style="height: calc(100vh - 100px);">
        <!-- Metadata Sidebar -->
        <div class="col-md-4 border-end overflow-auto p-3 bg-light">
            <h4><i class="bi bi-pencil-square"></i> Document Editor</h4>
            <hr>
            <form method="POST">
                {{ form.hidden_tag() }}
                <div class="mb-3">
                    {{ form.title.label(class="form-label") }}
                    {{ form.title(class="form-control") }}
                </div>
                <div class="mb-3">
                    {{ form.category.label(class="form-label") }}
                    {{ form.category(class="form-select") }}
                </div>
                <div class="mb-3">
                    {{ form.academic_period.label(class="form-label") }}
                    {{ form.academic_period(class="form-select") }}
                </div>
                <div class="mb-3">
                    {{ form.correspondent.label(class="form-label") }}
                    {{ form.correspondent(class="form-select") }}
                </div>
                <div class="mb-3">
                    {{ form.description.label(class="form-label") }}
                    {{ form.description(class="form-control", rows=4) }}
                </div>
                <div class="mb-3">
                    {{ form.tags.label(class="form-label") }}
                    {{ form.tags(class="form-control") }}
                    <small class="text-muted">Comma separated</small>
                </div>
                <div class="d-grid gap-2">
                    {{ form.submit(class="btn btn-primary") }}
                    <a href="{{ url_for('documents.detail', doc_id=document.id) }}" class="btn btn-outline-secondary">Back to Detail</a>
                </div>
            </form>
            
            {% if document.content_text %}
            <div class="mt-4">
                <h5>Extracted Text</h5>
                <pre class="bg-white p-2 border rounded" style="max-height: 300px; font-size: 0.8rem; overflow: auto; white-space: pre-wrap;">{{ document.content_text }}</pre>
            </div>
            {% endif %}
        </div>

        <!-- Document Preview -->
        <div class="col-md-8 bg-dark p-0">
            {% if preview.type == 'pdf' %}
                <iframe src="{{ url_for('documents.download', doc_id=document.id) }}#toolbar=0" style="width: 100%; height: 100%;" frameborder="0"></iframe>
            {% elif preview.type == 'image' %}
                <div class="d-flex align-items-center justify-content-center h-100 p-3">
                    <img src="{{ url_for('documents.download', doc_id=document.id) }}" class="img-fluid" style="max-height: 100%;" alt="Preview">
                </div>
            {% elif preview.type == 'text' %}
                <div class="p-4 text-white h-100">
                    <pre class="text-white h-100" style="overflow: auto; white-space: pre-wrap;">{{ preview.content }}</pre>
                </div>
            {% else %}
                <div class="d-flex flex-column align-items-center justify-content-center h-100 text-white">
                    <i class="bi bi-file-earmark-x display-1"></i>
                    <p class="mt-3">No preview available for this type.</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
    /* Ensure content takes full height */
    main.container {
        max-width: 100% !important;
        padding: 0 !important;
    }
    .container-fluid {
        height: 100%;
    }
</style>
{% endblock %}
